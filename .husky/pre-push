#!/bin/sh

# Pre-push hook: tests selon la branche
BRANCH=$(git rev-parse --abbrev-ref HEAD)

echo "ğŸš€ Running pre-push checks for branch: $BRANCH"

case "$BRANCH" in
  main|master)
    echo "ğŸ“¦ Production branch detected - Running FULL test suite..."
    echo "â³ This may take ~2 minutes..."

    # Full E2E tests for production
    pnpm test:preprod

    if [ $? -ne 0 ]; then
      echo "âŒ Pre-production tests failed! Push aborted."
      echo "ğŸ’¡ Fix the issues and try again, or use --no-verify to skip (not recommended)"
      exit 1
    fi

    echo "âœ… All production checks passed!"
    ;;

  develop|dev|staging)
    echo "ğŸ§ª Test branch detected - Running quick tests..."

    # Quick tests for develop/staging
    pnpm test:quick

    if [ $? -ne 0 ]; then
      echo "âŒ Quick tests failed! Push aborted."
      exit 1
    fi

    echo "âœ… Quick tests passed!"
    ;;

  *)
    echo "ğŸŒ¿ Feature branch detected - Running minimal checks..."

    # Just build check for feature branches
    pnpm build

    if [ $? -ne 0 ]; then
      echo "âŒ Build failed! Push aborted."
      exit 1
    fi

    echo "âœ… Build check passed!"
    ;;
esac
